<?php
if (isset($_POST['name'])) {
    session_start();
    extract($_POST);
    $id = $_SESSION['id'];
    print_r($_POST);
    include "../database.php";
    $query = "UPDATE `userdetails` SET `name` = '$name', `phoneNo` = '$phone' WHERE _id = $id";
    $result = mysqli_query($conn, $query);
    if ($result) {
        $_SESSION['name'] = $name;
        echo "
        <script>
            alert('profile updated');
            document.location='./profile.php';
        </script>";
    } else {
        echo "
        <script>
            console.log(\"" . mysqli_error($conn) . "\");
            alert('query execution failed');
            document.location='./profile.php';
        </script>";
    }
    exit;
}
include "./header.php";
include "../database.php";
$id = $_SESSION['id'];
$query = "SELECT * FROM `userdetails` WHERE _id=$id";
$result = mysqli_query($conn, $query);
if ($result) {
    if (mysqli_num_rows($result) == 1) {
        $userdata = mysqli_fetch_row($result);
    } else {
        echo "<script>alert('data fetch failed');</script>";
        exit;
    }
} else {
    echo "
    <script>
        console.log(\"" . mysqli_error($conn) . "\");
        alert(\"query execution failed\");
        document.location='./';
    </script>";
}
?>

<style>
    .form-floating label {
        color: black;
    }

    .form-signin {
        width: 100%;
        padding: 15px;
        margin: auto;
    }

    .form-signin .checkbox {
        font-weight: 400;
    }

    .form-signin .form-floating:focus-within {
        z-index: 2;
    }

    .form-signin input {
        margin-bottom: 20px;
        border-bottom-right-radius: 0;
        border-bottom-left-radius: 0;
    }

    .footer {
        padding: 10px;
        background: rgba(1, 1, 1, 0.8);
    }
</style>
<div style="margin: 10px;">
    <div class="container" style="background-color: white; border-radius: 20px; max-width: 800px;">
        <center>
            <h4 class="mt-3"><br>
                Profile
            </h4>
        </center>
        <hr class="hr">
        <div class="container ">
            <main class="form-signin" style="width: 100%;">
                <form action="profile.php" method="POST" style="width: 100%;">
                    <div class="row">
                        <div class="col-md-12">
                            <center>
                                <img src="../images/yogesh_travels.png" style="height: 200px; width:200px; border: isset; border-radius: 50%;border-color: black;">
                            </center>
                            <br><br>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" value="<?php echo $userdata[1]; ?>" class="form-control" disabled="" id="name" name="name" placeholder="name" autocomplete="off">
                                <label for="name">Name</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="email" value="<?php echo $userdata[2]; ?>" class="form-control" id="email" disabled="" readonly name="email" placeholder="name@example.com" autocomplete="off">
                                <label for="email">Email address</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="tel" value="<?php echo $userdata[4]; ?>" class="form-control" disabled="" id="phone" name="phone" placeholder="pno" autocomplete="off">
                                <label for="phone">Phone Number</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" value="<?php echo $userdata[5]; ?>" class="form-control" disabled="" readonly id="role" name="role" placeholder="role" autocomplete="off">
                                <label for="role">Role</label>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <center>
                                <a href="#" id="edit-btn" class="btn btn-success" onclick="activeEdit()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                                    </svg>
                                    Edit Profile
                                </a>
                                <input type="submit" value="Save Profile" class="btn btn-success" style="display: none;" id="submit-btn">
                            </center>
                        </div>
                    </div>
                </form>
            </main>
        </div>
    </div>
    <?php include "./footer.php"; ?>

    <script>
        function activeEdit() {
            document.getElementById('submit-btn').style.display = "block";
            document.getElementById('edit-btn').style.display = "none";
            document.getElementById('phone').removeAttribute('disabled');
            document.getElementById('name').removeAttribute('disabled');
        }
    </script>